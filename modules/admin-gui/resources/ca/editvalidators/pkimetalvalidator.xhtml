<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:p="http://primefaces.org/ui">
	<ui:remove>
		<!--
	    /*************************************************************************
	     *                                                                       *
	     *  EJBCA: The OpenSource Certificate Authority                          *
	     *                                                                       *
	     *  This software is free software; you can redistribute it and/or       *
	     *  modify it under the terms of the GNU Lesser General Public           *
	     *  License as published by the Free Software Foundation; either         *
	     *  version 2.1 of the License, or any later version.                    *
	     *                                                                       *
	     *  See terms of license at gnu.org.                                     *
	     *                                                                       *
	     *************************************************************************/
	     
	     $Id$
	     -->
	</ui:remove>
	
	
	<body>
		<ui:composition>
		  <h:panelGrid columns="2" styleClass="edit-top" cellspacing="3" cellpadding="3" border="0" width="100%" rowClasses="Row0,Row1" columnClasses="editColumn1,editColumn2">  
            <h:panelGroup>
                  <h:outputLabel for="settings" value="#{web.text.PKIMETAL_VALIDATOR_SETTINGS}" style="font-weight: bold;"/>&nbsp;
            </h:panelGroup>     
            <h:panelGroup id="settings" />                   
            <h:outputLabel for="url" styleClass="block" value="#{web.text.PKIMETAL_VALIDATOR_URL}"/>
            <h:panelGroup>
                <p:inputText id="url" size="60" value="#{validatorBean.validator.url}" disabled="#{validatorsBean.viewOnly}" placeholder="http://&lt;host&gt;:port">
                    <f:ajax render="connectedLabel" event="change" />
                    <f:ajax render="profiles" event="change" />
                    <f:ajax render="profileCheckboxes" event="change" />
                    <f:ajax render="autodetect" event="change" />
                    <f:ajax render="autodetectLabel" event="change" />
                    <f:ajax render="severityFail" event="change" />
                    <f:ajax render="severityLog" event="change" />
                </p:inputText>
                <p:commandButton value="#{web.text.PKIMETAL_VALIDATOR_PING}" action="#{validatorBean.validator.ping()}" disabled="#{validatorsBean.viewOnly}" />
            </h:panelGroup>
            <h:panelGroup/>
            <h:panelGroup id="connectedLabel">
              <h:outputLabel rendered="#{validatorBean.validator.isConnected()}"  styleClass="block" value="#{web.text.PKIMETAL_VALIDATOR_CONNECTED}"/>
              <h:outputLabel rendered="#{!validatorBean.validator.isConnected()}" styleClass="warning" value="#{web.text.PKIMETAL_VALIDATOR_NOT_CONNECTED}"/>
            </h:panelGroup>
            <h:outputLabel id="autodetectLabel"
                           for="autodetect"
                           styleClass="block"
                           value="#{web.text.PKIMETAL_VALIDATOR_AUTODETECT_PROFILE}" />
            <h:selectBooleanCheckbox id="autodetect"
                                     value="#{validatorBean.validator.autoDetect}"
                                     disabled="#{validatorsBean.viewOnly or !validatorBean.validator.isConnected()}">
              <f:ajax render="profileCheckboxes" event="change"/>
            </h:selectBooleanCheckbox>
            <!-- Available profiles from pkimetal -->
            <h:outputLabel
                           id="profiles-label" for="profiles" styleClass="block" value="#{web.text.PKIMETAL_VALIDATOR_AVAILABLE_PROFILES}"/>
            <h:panelGroup id="profiles">
                <p:selectManyCheckbox id="profileCheckboxes"
                                      styleClass="linter-profiles"
                                      value="#{validatorBean.validator.chosenProfiles}"
                                      disabled="#{validatorsBean.viewOnly or validatorBean.validator.autoDetect or !validatorBean.validator.isConnected()}">
                    <f:selectItems value="#{validatorBean.getGroupList()}"/>
                </p:selectManyCheckbox>
            </h:panelGroup>
            <!-- Severity level for failing the validator -->
            <h:outputLabel for="severityFail"
                           styleClass="block"
                           value="#{web.text.PKIMETAL_VALIDATOR_SEVERITY_FAIL}"/>
            <h:panelGroup id="severityFail">
                <p:selectOneMenu value="#{validatorBean.validator.severityFail}"
                                 disabled="#{validatorsBean.viewOnly or !validatorBean.validator.isConnected()}">
                    <f:selectItems value="#{validatorBean.validator.availableSeverities}"/>
                </p:selectOneMenu>
            </h:panelGroup>
            <!-- Severity level for logging to system log -->     
            <h:outputLabel for="severityLog" styleClass="block" value="#{web.text.PKIMETAL_VALIDATOR_SEVERITY_LOG}"/>
            <h:panelGroup id="severityLog">
                <p:selectOneMenu value="#{validatorBean.validator.severityLog}"
                                 disabled="#{validatorsBean.viewOnly or !validatorBean.validator.isConnected()}">
                    <f:selectItems value="#{validatorBean.validator.availableSeverities}"/>
                </p:selectOneMenu>
            </h:panelGroup>
            
		  </h:panelGrid>
		  
		  <h:panelGrid columns="2" styleClass="edit-top" cellspacing="3" cellpadding="3" border="0" width="100%" rowClasses="Row0,Row1" columnClasses="editColumn1,editColumn2">  
            <h:panelGroup>
                  <h:outputLabel for="testMode" value="#{web.text.PKIMETAL_VALIDATOR_TEST_MODE}" style="font-weight: bold;"/>&nbsp;
            </h:panelGroup>     
            <h:panelGroup id="testMode" /> 
            <h:outputLabel for="testFileUpload" styleClass="block" value="#{web.text.PKIMETAL_VALIDATOR_TEST_CERTIFICATE}"/>
            <h:panelGroup id="testFileUpload">
                <p:fileUpload value="#{validatorBean.testFile}" mode="advanced" auto="true" 
                           styleClass="ui-button-outlined ui-button-secondary" process="@this" update="messages"
                          listener="#{validatorBean.handleFileUpload}" disabled="#{!validatorBean.validator.isConnected()}">
                </p:fileUpload>
                <p:messages id="messages" showDetail="true" closable="false">
	               <p:autoUpdate/>
	           </p:messages>               
                <p:commandButton value="#{web.text.PKIMETAL_VALIDATOR_TEST}" action="#{validatorBean.testValidator()}" update="@all" disabled="#{!validatorBean.validator.isConnected()}"/>
            </h:panelGroup>
            <h:panelGroup rendered="#{validatorBean.hasTestResults()}"  /> 
            <h:panelGroup rendered="#{validatorBean.hasTestResults()}" >
		      <p:scrollPanel id="testResults" mode="native" style="width:800px;height:200px" disabled="#{!validatorBean.validator.isConnected()}">
			        <p class="m-0">
			            <h:outputText value="#{validatorBean.testResults}" escape="false"/>
			        </p>
                </p:scrollPanel>
            </h:panelGroup>
            
        </h:panelGrid>
		  
		  
		  
		</ui:composition>
	</body>

</html>