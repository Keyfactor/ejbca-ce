<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions">
<ui:remove>
	<!--
    /*************************************************************************
     *                                                                       *
     *  EJBCA: The OpenSource Certificate Authority                          *
     *                                                                       *
     *  This software is free software; you can redistribute it and/or       *
     *  modify it under the terms of the GNU Lesser General Public           *
     *  License as published by the Free Software Foundation; either         *
     *  version 2.1 of the License, or any later version.                    *
     *                                                                       *
     *  See terms of license at gnu.org.                                     *
     *                                                                       *
     *************************************************************************/

      -->
</ui:remove>


<ui:composition template="/WEB-INF/include/template.xhtml">

	<ui:param name="resourceBean" value="#{addEndEntityMBean}" />
	<ui:define name="content">
		<p:inputText rendered="false" />
		<h1>
			<h:outputText value="#{web.text.ADDENDENTITY}" />
		</h1>

		<h:form id="addendentity" enctype="multipart/form-data">

			<h:panelGrid columns="2" styleClass="edit-top" cellspacing="3"
				cellpadding="3" border="0" width="100%" rowClasses="Row1"
				columnClasses="editColumnSystem1,editColumn2">
				<h:outputLabel for="header_endentityprofile"
					value="#{web.text.ENDENTITYPROFILE}"
					style="font-weight:bold; font-size:1.2em;" />

				<h:panelGroup id="endEntityProfile">
					<h:selectOneMenu value="#{resourceBean.selectedEeProfileId}"
						disabled="#{!resourceBean.allowedToAddEndEntity}">
						<f:selectItems value="#{resourceBean.availableEndEntityProfiles}" />
						<f:ajax render="addendentity"
							listener="#{resourceBean.actionChangeEndEntityProfile}" />
					</h:selectOneMenu>
				</h:panelGroup>

				<h:panelGroup>
					<h:outputLabel id="userNameLabel" for="username" value="#{web.text.USERNAME}"
						styleClass="titles" />
				</h:panelGroup>

				<h:panelGroup>
					<h:inputText id="userName" value="#{resourceBean.userName}"
						required="true" styleClass="mandatory" size="45"
						title="#{resourceBean.usernameTitle}" label="Username"
						disabled="#{!resourceBean.allowedToAddEndEntity or resourceBean.usernameAutoGenerated}" />
				</h:panelGroup>

				<h:panelGroup rendered="#{!resourceBean.useAutoGeneratedPassword}">
					<h:outputLabel id="userPasswordLabel" for="userPassword"
						value="#{web.text.PASSWORDORENROLLMENTCODE}" />
				</h:panelGroup>

				<h:panelGroup rendered="#{!resourceBean.useAutoGeneratedPassword}">
					<h:inputSecret id="userPassword" name="password" size="25"
						maxlength="225" redisplay="true" autocomplete="off"
						required="#{resourceBean.passwordRequiredInProfile}" label="Password" 
						styleClass="#{resourceBean.passwordRequiredInProfile ? 'mandatory' : ''}"
						disabled="#{!resourceBean.allowedToAddEndEntity}"
						value="#{resourceBean.passwordFieldValue}">
					</h:inputSecret>
					<h:outputLabel rendered="#{resourceBean.passwordPreDefined}" value="#{web.text.PASSWORD_DEFINED_IN_PROFILE}"/>
				</h:panelGroup>

				<h:panelGroup rendered="#{!resourceBean.useAutoGeneratedPassword}">
					<h:outputLabel for="userConfirmPassword" id="userConfirmPasswordLabel"
						value="#{web.text.CONFIRMPASSWORD}" />
				</h:panelGroup>

				<h:panelGroup rendered="#{!resourceBean.useAutoGeneratedPassword}">
					<h:inputSecret id="userConfirmPassword" 
						size="25" maxlength="225" redisplay="true" autocomplete="off"
						label="Password Confirmation" 
						value="#{resourceBean.confirmPasswordFieldValue}"
						disabled="#{!resourceBean.allowedToAddEndEntity}">
					</h:inputSecret>
				</h:panelGroup>

				<h:panelGroup rendered="#{resourceBean.useMaxFailedLoginAttempts}">
					<h:outputLabel for="maxFailedLoginAttempts" id="maxFailedLoginAttemptsLabel"
						value="#{web.text.MAXFAILEDLOGINATTEMPTS}" />
				</h:panelGroup>
				<h:panelGroup rendered="#{resourceBean.useMaxFailedLoginAttempts}">
					<h:panelGrid columns="3">
						<h:selectOneRadio id="maxLoginAttemptsSpecifiedRadio"
							value="#{resourceBean.maxLoginAttemptsStatus}"
							readonly="#{!resourceBean.allowedToAddEndEntity or !resourceBean.maxFailedLoginAttemptsModifiable}">
							<f:selectItem itemLabel="#{web.text.UNLIMITED}"
								itemValue="unlimited" />
							<f:selectItem itemLabel="#{web.text.SPECIFIED}"
								itemValue="specified" />
							<f:ajax
								render=":addendentity:maxLoginAttemptsSpecifiedText maxLoginAttemptsUnlimitedRadio" />
						</h:selectOneRadio>
						<h:inputText id="maxLoginAttemptsSpecifiedText"
							value="#{resourceBean.maxLoginAttempts}" size="5"
							title="#{web.text.FORMAT_INTEGER}"
							disabled="#{resourceBean.maxLoginAttemptsStatus eq 'unlimited'}"
							readonly="#{!resourceBean.allowedToAddEndEntity or !resourceBean.maxFailedLoginAttemptsModifiable}" />
					</h:panelGrid>
				</h:panelGroup>
				<h:panelGroup rendered="#{resourceBean.useBatchGenerationPassword}">
					<h:outputLabel for="useClearTextPassword" id="useClearTextPasswordLabel"
						value="#{web.text.USEINBATCH}" />
				</h:panelGroup>
				<h:panelGroup rendered="#{resourceBean.useBatchGenerationPassword}">
					<h:selectBooleanCheckbox id="useClearTextPassword"
						value="#{resourceBean.useClearTextPasswordStorage}"
						disabled="#{resourceBean.clearTextPasswordRequired}" />
					<h:outputLabel value="#{web.text.USE}" for="useClearTextPassword" />
				</h:panelGroup>
				
				<h:panelGroup rendered="#{resourceBean.useEmail}">
					<h:outputLabel for="useEmail" value="#{web.text.EMAIL}" />
				</h:panelGroup>
				<h:panelGroup rendered="#{resourceBean.useEmail}">
					<h:inputText id="emailNoModify"
						required="#{resourceBean.profileEmailRequired}"
						styleClass="#{resourceBean.profileEmailRequired ? 'mandatory' : ''}"
						label="Email Username"						
						value="#{resourceBean.emailUserName}" size="20" maxlength="255"
						readonly="#{!resourceBean.allowedToAddEndEntity}" /> @
					<h:outputLabel value="#{resourceBean.emailDomain}"
						rendered="#{!resourceBean.emailModifiable and fn:length(resourceBean.availableEmailDomains) == 1}" 
						style="font-weight:bold"/>
					<h:selectOneMenu
						id="selectEmailDomain"
						rendered="#{!resourceBean.emailModifiable and fn:length(resourceBean.availableEmailDomains) > 1}"
						value="#{resourceBean.emailDomain}"
						disabled="#{!resourceBean.allowedToAddEndEntity}">
						<f:selectItems value="#{resourceBean.availableEmailDomains}" />
					</h:selectOneMenu>
					<h:inputText id="emailModify"
						rendered="#{resourceBean.emailModifiable}"
						required="#{resourceBean.profileEmailRequired}"
						styleClass="#{resourceBean.profileEmailRequired ? 'mandatory' : ''}"
						label="Email Domain"
						value="#{resourceBean.emailDomain}" size="15" maxlength="255"
						title="#{web.text.FORMAT_DOMAINNAME}"
						readonly="#{!resourceBean.allowedToAddEndEntity}" />
				</h:panelGroup>
			</h:panelGrid>

			<!-- Subject DN Section -->

			<h:panelGrid columns="2" styleClass="edit-top" cellspacing="3"
				cellpadding="3" border="0" width="100%" rowClasses="Row1"
				columnClasses="editColumnSystem1,editColumn2">
				<h:outputLabel value="#{web.text.CERT_SUBJECTDN_ATTRIBUTES}"
					style="font-weight:bold; font-size:1.2em;" />

				<h:panelGroup />
				<c:forEach items="#{resourceBean.subjectDnFieldsAndDatas}" varStatus="subjectDnField"
					var="subjectDnFieldAndData">
					<h:panelGroup>
						<h:outputLabel value="#{subjectDnFieldAndData.label}" id="labelSDN${subjectDnField.index + 1}"/>
					</h:panelGroup>
					<h:panelGroup
						rendered="#{!subjectDnFieldAndData.isEmailAndUsesEmailFieldData.left and !subjectDnFieldAndData.modifiable   
										      and fn:length(subjectDnFieldAndData.options) == 1}">
						<h:outputLabel
							id="emailDomain${subjectDnField.index + 1}"
							value="#{subjectDnFieldAndData.options[0].trim()}"
							style="font-weight:bold" />
					</h:panelGroup>
					<h:panelGroup
						rendered="#{!subjectDnFieldAndData.isEmailAndUsesEmailFieldData.left 
										      and !subjectDnFieldAndData.modifiable 
										      and fn:length(subjectDnFieldAndData.options) > 1 }">
						<h:selectOneMenu
							id="useEmailFieldDataCheckBox${subjectDnField.index + 1}" 
							value="#{subjectDnFieldAndData.fieldValue}"
							disabled="#{!resourceBean.allowedToAddEndEntity}">
							<f:selectItems value="#{subjectDnFieldAndData.options}" />
						</h:selectOneMenu>
					</h:panelGroup>
					<h:panelGroup 
						rendered="#{!subjectDnFieldAndData.isEmailAndUsesEmailFieldData.left and subjectDnFieldAndData.modifiable and subjectDnFieldAndData.regex ne null}">
						<h:inputText 
							id="valueWithRegex${subjectDnField.index + 1}"
							value="#{subjectDnFieldAndData.fieldValue}" 
							size="40" maxlength="255"
							title="Must match format specified in profile. / Technical detail - the regex is #{subjectDnFieldAndData.regex}"
							readonly="#{!resourceBean.allowedToAddEndEntity}"
							required="#{subjectDnFieldAndData.required}"
							styleClass="#{subjectDnFieldAndData.required ? 'mandatory' : ''}"
							label="#{subjectDnFieldAndData.label}">
							<f:validateRegex pattern="#{subjectDnFieldAndData.regex}" /> 
						</h:inputText>
					</h:panelGroup>
					<h:panelGroup 
						rendered="#{!subjectDnFieldAndData.isEmailAndUsesEmailFieldData.left and subjectDnFieldAndData.modifiable and subjectDnFieldAndData.regex eq null}">
						<h:inputText 
							id="valueWithoutRegex${subjectDnField.index + 1}"
							value="#{subjectDnFieldAndData.fieldValue}" 
							size="40" maxlength="255"
							readonly="#{!resourceBean.allowedToAddEndEntity}"
							required="#{subjectDnFieldAndData.required}"
							label="#{subjectDnFieldAndData.label}"
							styleClass="#{subjectDnFieldAndData.required ? 'mandatory' : ''}">
						</h:inputText>
					</h:panelGroup>
					
					<h:panelGroup
						rendered="#{subjectDnFieldAndData.isEmailAndUsesEmailFieldData.left}">
						<h:selectBooleanCheckbox 
							id="sdnEmail"
							value="#{subjectDnFieldAndData.isEmailAndUsesEmailFieldData.right}"
							disabled="#{subjectDnFieldAndData.required}" />
						<h:outputLabel value="#{web.text.USESEMAILFIELDDATA}" />
					</h:panelGroup>
				</c:forEach>
			</h:panelGrid>


			<!-- Subject Alternative Names Section -->

 			<h:panelGrid columns="2" styleClass="edit-top" cellspacing="3"
				cellpadding="3" border="0" width="100%" rowClasses="Row1"
				columnClasses="editColumnSystem1,editColumn2"
				rendered="#{resourceBean.profileHasSubjectAltNameFields}">
				<h:outputLabel value="#{web.text.SUBJECTALTNAMES}"
					style="font-weight:bold; font-size:1.2em;" />

				<h:panelGroup />

				<c:forEach items="#{resourceBean.subjectAltNameFieldDatas}"
					var="subjectAltNameFieldAndData" varStatus="subjecAltField">

					<h:panelGroup>
						<h:outputLabel 
							id="labelSAN${subjecAltField.index + 1}"
						 	value="#{subjectAltNameFieldAndData.label}" />
					</h:panelGroup>

					<h:panelGroup
						rendered="#{subjectAltNameFieldAndData.rfc822Name and subjectAltNameFieldAndData.renderDataFromRFC822CheckBox}">
						<h:selectBooleanCheckbox id="altNameEmail" value="#{subjectAltNameFieldAndData.useDataFromRFC822NameField}"
							disabled="#{subjectAltNameFieldAndData.required}" 
							 />
						<h:outputLabel value="#{web.text.USESEMAILFIELDDATA}" />
					</h:panelGroup>

					<h:panelGroup
						rendered="#{subjectAltNameFieldAndData.rfc822Name and !subjectAltNameFieldAndData.renderDataFromRFC822CheckBox
									and (subjectAltNameFieldAndData.modifiable or subjectAltNameFieldAndData.rfc822NameStringHaveAtSign)}">
						<h:inputText
							id="rfcName${subjecAltField.index + 1}"
							value="#{subjectAltNameFieldAndData.rfcName}"
							size="20" maxlength="255"
							label="#{subjectAltNameFieldAndData.label}"
							required="#{subjectAltNameFieldAndData.required}"
							styleClass="#{subjectAltNameFieldAndData.required ? 'mandatory' : ''}"							
							readonly="#{!resourceBean.allowedToAddEndEntity}"> 
						</h:inputText> @
						<h:inputText
							id="rfcDomain${subjecAltField.index + 1}"
							value="#{subjectAltNameFieldAndData.rfcDomain}"
							size="15" maxlength="255" 
							title="#{web.text.FORMAT_DOMAINNAME}"
							label="#{subjectAltNameFieldAndData.label}"
							required="#{subjectAltNameFieldAndData.required}"
							styleClass="#{subjectAltNameFieldAndData.required ? 'mandatory' : ''}"								
							readonly="#{!resourceBean.allowedToAddEndEntity}">
						</h:inputText>
					</h:panelGroup>

					<h:panelGroup
						rendered="#{subjectAltNameFieldAndData.rfc822Name 
									and !subjectAltNameFieldAndData.modifiable and fn:length(subjectAltNameFieldAndData.options) == 1}">
						<h:outputLabel
							id="fieldValueLabel${subjecAltField.index + 1}"
							value="#{subjectAltNameFieldAndData.fieldValue}"
							style="font-weight:bold" />
					</h:panelGroup>

					<h:panelGroup
						rendered="#{subjectAltNameFieldAndData.rfc822Name  
									and !subjectAltNameFieldAndData.modifiable and fn:length(subjectAltNameFieldAndData.options) > 1}}">

						<h:selectOneMenu
							id="fieldValueSelectOne${subjecAltField.index + 1}"
							value="#{subjectAltNameFieldAndData.fieldValue}"
							disabled="#{!resourceBean.allowedToAddEndEntity}">
							<f:selectItems
								value="#{subjectAltNameFieldAndData.options}" />
						</h:selectOneMenu>
					</h:panelGroup>

					<h:panelGroup rendered="#{!subjectAltNameFieldAndData.rfc822Name 
											   and !subjectAltNameFieldAndData.modifiable 
											   and !subjectAltNameFieldAndData.upn
											   and !subjectAltNameFieldAndData.copyDataFromCN}">
						<h:outputLabel
							id="altNameField${subjecAltField.index + 1}"
							rendered="#{(!subjectAltNameFieldAndData.rfc822Name and !subjectAltNameFieldAndData.modifiable and fn:length(subjectAltNameFieldAndData.options) == 1)}"
							value="#{subjectAltNameFieldAndData.fieldValue}"
							style="font-weight:bold" />
						
						<h:selectOneMenu
							id="subjectAltField${subjecAltField.index + 1}"
							rendered="#{!subjectAltNameFieldAndData.rfc822Name and !subjectAltNameFieldAndData.modifiable and fn:length(subjectAltNameFieldAndData.options) > 1}"
							value="#{subjectAltNameFieldAndData.fieldValue}"
							disabled="#{!resourceBean.allowedToAddEndEntity}">
							<f:selectItems value="#{subjectAltNameFieldAndData.options}" />
						</h:selectOneMenu>
					</h:panelGroup>

					<h:panelGroup rendered="#{!subjectAltNameFieldAndData.modifiable 
											  and subjectAltNameFieldAndData.upn}">
						<h:inputText
							id="subjectAltNameUpnName${subjecAltField.index + 1}"
							size="20" maxlength="355" 
							value="#{subjectAltNameFieldAndData.upnName}"
							label = "#{subjectAltNameFieldAndData.label}"
							required="#{subjectAltNameFieldAndData.required}"
							title="#{subjectAltNameFieldAndData.copyDataFromCN ? 'Will be copied from CN' : ''}"
							disabled="#{subjectAltNameFieldAndData.copyDataFromCN}"
							styleClass="#{subjectAltNameFieldAndData.required ? 'mandatory' : ''}"
							readonly="#{!resourceBean.allowedToAddEndEntity}">
						</h:inputText> @
						
						<h:outputLabel
							id="subjectAltNameUpnDomainOneOption${subjecAltField.index + 1}"
							rendered="#{!subjectAltNameFieldAndData.modifiable and fn:length(subjectAltNameFieldAndData.options) == 1}"
							value="#{subjectAltNameFieldAndData.upnDomain}"
							style="font-weight:bold" />
						
						<h:selectOneMenu
							id="subjectAltNameUpnDomainMultiOption${subjecAltField.index + 1}"
							rendered="#{!subjectAltNameFieldAndData.modifiable and fn:length(subjectAltNameFieldAndData.options) > 1}"
							value="#{subjectAltNameFieldAndData.upnDomain}"
							disabled="#{!resourceBean.allowedToAddEndEntity}">
							<f:selectItems value="#{subjectAltNameFieldAndData.options}" />
						</h:selectOneMenu>
					</h:panelGroup>
					
					
					<h:panelGroup rendered="#{subjectAltNameFieldAndData.modifiable 
											   and subjectAltNameFieldAndData.upn}">
						<h:inputText
							id="subjectAltNameUpnNameModifiableNoOptions${subjecAltField.index + 1}"
							size="20" maxlength="355" 
							value="#{subjectAltNameFieldAndData.upnName}"
							label = "#{subjectAltNameFieldAndData.label}"
							required="#{subjectAltNameFieldAndData.required}"
							title="#{subjectAltNameFieldAndData.copyDataFromCN ? 'Will be copied from CN' : ''}"
							disabled="#{subjectAltNameFieldAndData.copyDataFromCN}"
							styleClass="#{subjectAltNameFieldAndData.required ? 'mandatory' : ''}"
							readonly="#{!resourceBean.allowedToAddEndEntity}">
						</h:inputText> @
						
						<h:inputText
							id="subjectAltNameUpnDomainModifiableNoOptions${subjecAltField.index + 1}"
							size="15" maxlength="355" 
							value="#{subjectAltNameFieldAndData.upnDomain}"
							label = "#{subjectAltNameFieldAndData.label}"
							required="#{subjectAltNameFieldAndData.required}"
							styleClass="#{subjectAltNameFieldAndData.required ? 'mandatory' : ''}"
							readonly="#{!resourceBean.allowedToAddEndEntity}">
						</h:inputText> 
					</h:panelGroup>

					<h:panelGroup
						rendered="#{!subjectAltNameFieldAndData.rfc822Name and
						 			!subjectAltNameFieldAndData.upn and
									 subjectAltNameFieldAndData.copyDataFromCN}">
						<h:selectBooleanCheckbox 
							id="altNameDns"
							value="true" disabled="true"/>
						<h:outputLabel value="#{web.text.USESCNFIELDDATA}" />
					</h:panelGroup>

					<h:panelGroup
						rendered="#{!subjectAltNameFieldAndData.rfc822Name and 
									 subjectAltNameFieldAndData.modifiable and 
									 !subjectAltNameFieldAndData.upn and
									 !subjectAltNameFieldAndData.copyDataFromCN}">
						<h:inputText
							id="subjectAltNameInputTextWithoutRegex${subjecAltField.index + 1}"
							size="40" maxlength="355" rendered="#{!subjectAltNameFieldAndData.renderRegex}"
							value="#{subjectAltNameFieldAndData.fieldValue}"
							label = "#{subjectAltNameFieldAndData.label}"
							required="#{subjectAltNameFieldAndData.required}"
							styleClass="#{subjectAltNameFieldAndData.required ? 'mandatory' : ''}"
							readonly="#{!resourceBean.allowedToAddEndEntity}">
						</h:inputText>
						<h:inputText
							id="subjectAltNameInputTextWithRegex${subjecAltField.index + 1}"
							size="40" maxlength="355" rendered="#{subjectAltNameFieldAndData.renderRegex}"
							value="#{subjectAltNameFieldAndData.fieldValue}"
							title="Must match format specified in profile. / Technical detail - the regex is #{subjectAltNameFieldAndData.regex}"
							label = "#{subjectAltNameFieldAndData.label}"
							required="#{subjectAltNameFieldAndData.required}"
							styleClass="#{subjectAltNameFieldAndData.required ? 'mandatory' : ''}"
							readonly="#{!resourceBean.allowedToAddEndEntity}">
						<f:validateRegex pattern="#{subjectAltNameFieldAndData.regex}"/>
						</h:inputText>
					</h:panelGroup>

				</c:forEach>

			</h:panelGrid>

			<!-- Subject Directory Attributes Section -->

			<h:panelGrid columns="2" styleClass="edit-top" cellspacing="3"
				cellpadding="3" border="0" width="100%" rowClasses="Row1"
				columnClasses="editColumnSystem1,editColumn2"
				rendered="#{resourceBean.profileHasSubjectDirAttrFields}">
				<h:outputLabel value="#{web.text.SUBJECTDIRATTRIBUTES}"
					style="font-weight:bold; font-size:1.2em;" />

				<h:panelGroup />

				<c:forEach items="#{resourceBean.subjectDirAttrFieldDatas}"
					var="subjectDirAttrFieldNameAndData" varStatus="subjectDirAttr" >

					<h:panelGroup>
						<h:outputLabel id="labelSDA${subjectDirAttr.index + 1}" value="#{subjectDirAttrFieldNameAndData.label}" />
					</h:panelGroup>

					<h:outputLabel
						id="oneOptionSDA${subjectDirAttr.index + 1}"
						rendered="#{!subjectDirAttrFieldNameAndData.modifiable and fn:length(subjectDirAttrFieldNameAndData.options) == 1}"
						value="#{subjectDirAttrFieldNameAndData.fieldValue}"
						style="font-weight:bold" />

					<h:selectOneMenu
						id="multiOptionsSDA${subjectDirAttr.index + 1}"
						rendered="#{!subjectDirAttrFieldNameAndData.modifiable and fn:length(subjectDirAttrFieldNameAndData.options) > 1}"
						value="#{subjectDirAttrFieldNameAndData.fieldValue}"
						disabled="#{!resourceBean.allowedToAddEndEntity}">
						<f:selectItems value="#{subjectDirAttrFieldNameAndData.options}" />
					</h:selectOneMenu>

					<h:panelGroup
						rendered="#{subjectDirAttrFieldNameAndData.modifiable}">
						<h:inputText size="20" maxlength="255"
							id="inputTextSDA${subjectDirAttr.index + 1}"
							value="#{subjectDirAttrFieldNameAndData.fieldValue}"
							readonly="#{!resourceBean.allowedToAddEndEntity}"
							required="#{subjectDirAttrFieldNameAndData.required}"
							label="#{subjectDirAttrFieldNameAndData.label}"
							styleClass="#{subjectDirAttrFieldNameAndData.required ? 'mandatory' : ''}">
						</h:inputText>
					</h:panelGroup>

				</c:forEach>

			</h:panelGrid>

			<!--  Main certificate data  -->

			<h:panelGrid columns="2" styleClass="edit-top" cellspacing="3"
				cellpadding="3" border="0" width="100%" rowClasses="Row1"
				columnClasses="editColumnSystem1,editColumn2">
				<h:outputLabel value="#{web.text.MAINCERTIFICATEDATA}"
					style="font-weight:bold; font-size:1.2em;" />
				<h:panelGroup />


				<h:outputLabel for="selectedCertProfile" id= "selectedCertProfileLabel"
					value="#{web.text.CERTIFICATEPROFILE}" style="font-size:1.2em;" />

				<h:panelGroup id="selectedCertProfile">
					<h:selectOneMenu value="#{resourceBean.selectedCertProfileId}"
						disabled="#{!resourceBean.allowedToAddEndEntity}">
						<f:selectItems value="#{resourceBean.availableCertProfiles}" />
					<f:ajax event="change" render="selectedCa"/>
					</h:selectOneMenu>
				</h:panelGroup>
				
				<h:outputLabel for="selectedCa" id="selectedCaLabel"
					value="#{web.text.CA}" style="font-size:1.2em;" />

				<h:panelGroup id="selectedCa">
					<h:selectOneMenu value="#{resourceBean.selectedCaId}"
						disabled="#{!resourceBean.allowedToAddEndEntity}">
						<f:selectItems value="#{resourceBean.availableCas}" />
					</h:selectOneMenu>
				</h:panelGroup>

				<h:outputLabel id="tokenLabel" value="#{web.text.TOKEN}" style="font-size:1.2em;" />

				<h:panelGroup id="token">
					<h:selectOneMenu value="#{resourceBean.selectedTokenId}"
						disabled="#{!resourceBean.allowedToAddEndEntity}">
						<f:selectItems value="#{resourceBean.availableTokens}" />
						<f:ajax render="addendentity:useKeyRecovery" listener="#{resourceBean.keyRecoveryCheckboxStatusUpdate()}"/>
					</h:selectOneMenu>
				</h:panelGroup>
			</h:panelGrid>


			<!-- Other certificate data -->

			<h:panelGrid columns="2" styleClass="edit-top" cellspacing="3"
				cellpadding="3" border="0" width="100%" rowClasses="Row1"
				columnClasses="editColumnSystem1,editColumn2"
				rendered="#{resourceBean.renderOtherCertDataSection}">
				<h:outputLabel value="#{web.text.OTHERCERTIFICATEDATA}"
					style="font-weight:bold; font-size:1.2em;" />

				<h:panelGroup />

				<h:panelGroup rendered="#{resourceBean.customSerialNumberUsed}">

					<h:outputLabel id="customSerialNumberLabel" value="#{web.text.CERT_SERIALNUMBER_HEXA}"
						style="font-size:1.2em;" />
					<br />
					<h:outputLabel styleClass="help"
						value="(#{web.text.EXAMPLE.toLowerCase()} : 1234567890ABCDEF)" />

				</h:panelGroup>

				<h:panelGroup rendered="#{resourceBean.customSerialNumberUsed}">
					<h:inputText size="20" maxlength="40" id="customSerialNumber"
						title="#{web.text.FORMAT_HEXA}" class="hexa" value="#{resourceBean.customSerialNumber}" />
				</h:panelGroup>


				<h:panelGroup rendered="#{resourceBean.validityStartTimeUsed}">
					<h:outputLabel value="#{web.text.TIMEOFSTART}" id="validityStartTimeUsedLabel"
						style="font-size:1.2em;" />
					<h:outputText
						value="#{web.ejbcaWebBean.getHelpReference('/End_Entity_Profiles.html#Certificate_Validity')}"
						escape="false" styleClass="helpReference" />
					<br />
					<h:outputLabel styleClass="help"
						value="#{resourceBean.validityTimeHelpText}" />
				</h:panelGroup>

				<h:panelGroup rendered="#{resourceBean.validityStartTimeUsed}">
					<h:inputText size="25" maxlength="40"
						id="validityStartTimeUsed"
						title="#{resourceBean.validityTimeTitle}"
						value="#{resourceBean.validityStartTimeValue}"
						readonly="#{resourceBean.validityStartTimeReadOnly}"
						required="#{resourceBean.validityStartTimeRequired}"
						styleClass="#{resourceBean.validityStartTimeRequired ? 'mandatory' : ''}" />
				</h:panelGroup>

				<h:panelGroup rendered="#{resourceBean.validityEndTimeUsed}">
					<h:outputLabel value="#{web.text.TIMEOFEND}" 
						id="validityEndTimeUsedLabel"
						style="font-size:1.2em;" />
					<h:outputText
						value="#{web.ejbcaWebBean.getHelpReference('/End_Entity_Profiles.html#Certificate_Validity')}"
						escape="false" styleClass="helpReference" />
					<br />
					<h:outputLabel styleClass="help"
						value="#{resourceBean.validityTimeHelpText}" />
				</h:panelGroup>

				<h:panelGroup rendered="#{resourceBean.validityEndTimeUsed}">
					<h:inputText size="25" maxlength="40"
						id="validityEndTimeUsed"
						title="#{resourceBean.validityTimeTitle}"
						value="#{resourceBean.validityEndTimeValue}"
						readonly="#{resourceBean.validityEndTimeReadOnly}"
						required="#{resourceBean.validityEndTimeRequired}"
						styleClass="#{resourceBean.validityEndTimeRequired ? 'mandatory' : ''}" />
				</h:panelGroup>

				<h:panelGroup rendered="#{resourceBean.cardNumberUsed}">
					<h:outputLabel
						id="cardNumberUsedLabel" 
						value="#{web.text.CARDNUMBER}"
						style="font-size:1.2em;" />
				</h:panelGroup>

				<h:panelGroup rendered="#{resourceBean.cardNumberUsed}">
					<h:inputText 
						id="cardNumberUsed" 
						size="20" maxlength="40"
						title="#{web.text.FORMAT_STRING}"
						value="#{resourceBean.cardNumber}"
						styleClass="#{resourceBean.cardNumberRequired ? 'mandatory' : ''}" />
				</h:panelGroup>

				<h:panelGroup
					rendered="#{resourceBean.nameConstraintsPermittedUsed}">

					<h:outputLabel
						id="nameConstraintsPermittedLabel" 
						value="#{web.text.EXT_PKIX_NC_PERMITTED}"
						style="font-size:1.2em;" />
					<h:outputText
						value="#{web.ejbcaWebBean.getHelpReference('/CA_Fields.html#Name_Constraints')}"
						escape="false" styleClass="helpReference" />
					<br />
					<h:outputLabel styleClass="help"
						value="#{resourceBean.nameConstraintsPermittedHelpText}" />

				</h:panelGroup>

				<h:panelGroup
					rendered="#{resourceBean.nameConstraintsPermittedUsed}">

					<h:inputTextarea
						id="nameConstraintsPermitted" 
						rows="4" cols="38"
						styleClass="#{resourceBean.nameConstraintsPermittedRequired ? 'mandatory' : ''}"
						value="#{resourceBean.nameConstraintsPermitted}" />
				</h:panelGroup>

				<h:panelGroup rendered="#{resourceBean.nameConstraintsExcludedUsed}">

					<h:outputLabel
						id="nameConstraintsExcludedLabel" 
						value="#{web.text.EXT_PKIX_NC_EXCLUDED}"
						style="font-size:1.2em;" />
					<h:outputText
						value="#{web.ejbcaWebBean.getHelpReference('/CA_Fields.html#Name_Constraints')}"
						escape="false" styleClass="helpReference" />
					<br />
					<h:outputLabel styleClass="help"
						value="#{resourceBean.nameConstraintsExcludedHelpText}" />
				</h:panelGroup>

				<h:panelGroup rendered="#{resourceBean.nameConstraintsExcludedUsed}">

					<h:inputTextarea
						id="nameConstraintsExcluded" 
						rows="4" cols="38"
						styleClass="#{resourceBean.nameConstraintsExcludedRequired ? 'mandatory' : ''}"
						value="#{resourceBean.nameConstraintsExcluded}" />
				</h:panelGroup>

				<h:panelGroup rendered="#{resourceBean.useExtensionData}">
					<h:outputLabel value="#{web.text.CERT_EXTENSIONDATA}"
						style="font-size:1.2em;" />
				</h:panelGroup>

				<h:panelGroup rendered="#{resourceBean.useExtensionData}">

					<h:inputTextarea rows="4" cols="38"
						value="#{resourceBean.extensionData}" />
				</h:panelGroup>

				<h:panelGroup rendered="#{resourceBean.psd2QcStatementUsed}">
					<h:outputLabel
						id="psd2NcaNameLabel" 
						value="#{web.text.PSD2_NCANAME}"
						style="font-size:1.2em;" />
				</h:panelGroup>

				<h:panelGroup rendered="#{resourceBean.psd2QcStatementUsed}">

					<h:inputText 
						id="psd2NcaName" 
						size="30" maxlength="256"
						value="#{resourceBean.psd2NcaName}" />
				</h:panelGroup>

				<h:panelGroup rendered="#{resourceBean.psd2QcStatementUsed}">
					<h:outputLabel
						id="psd2NcaIdLabel" 
						value="#{web.text.PSD2_NCAID}"
						style="font-size:1.2em;" />
				</h:panelGroup>

				<h:panelGroup rendered="#{resourceBean.psd2QcStatementUsed}">
					<h:inputText
						id="psd2NcaId" 
						size="30" maxlength="256"
						value="#{resourceBean.psd2NcaId}" />
				</h:panelGroup>

				<h:panelGroup rendered="#{resourceBean.psd2QcStatementUsed}">
					<h:outputLabel 
						id="psd2PspRolesLabel"
						value="#{web.text.PSD2_PSP_ROLES}"
						style="font-size:1.2em;" />
				</h:panelGroup>

				<h:panelGroup rendered="#{resourceBean.psd2QcStatementUsed}">
					<h:selectManyListbox
						id="psd2PspRoles"
						value="#{resourceBean.psd2PspRoles}" size="4"
						styleClass="select-list">
						<f:selectItems value="#{resourceBean.availablePsd2PspRoles}" />
					</h:selectManyListbox>
				</h:panelGroup>

				<h:panelGroup
					rendered="#{resourceBean.cabfOrganizationIdentifierUsed}">
					<h:outputLabel
						id="cabFOrganizationIdLabel" 
						value="#{web.text.EXT_CABF_ORGANIZATION_IDENTIFIER}"
						style="font-size:1.2em;" />
				</h:panelGroup>

				<h:panelGroup
					rendered="#{resourceBean.cabfOrganizationIdentifierUsed}">
					<h:inputText
						id="cabFOrganizationId" 
						size="30" maxlength="256"
						value="#{resourceBean.cabfOrganizationIdentifier}"
						readonly="#{resourceBean.cabfOrganizationIdentifierReadOnly}"
						title="#{web.text.EXT_CABF_ORGANIZATION_IDENTIFIER_FORMAT}"
						styleClass="#{resourceBean.cabfOrganizationIdentifierRequired ? 'mandatory' : ''}">
						<f:validateRegex pattern="[A-Z0-9]{5,5}(\+[A-Z0-9]+)?-.+" />
					</h:inputText>
				</h:panelGroup>
			</h:panelGrid>


			<!--  Other data  -->

			<h:panelGrid columns="2" styleClass="edit-top" cellspacing="3"
				cellpadding="3" border="0" width="100%" rowClasses="Row1"
				columnClasses="editColumnSystem1,editColumn2"
				rendered="#{resourceBean.renderOtherDataSection}">
				<h:outputLabel value="#{web.text.OTHERDATA}"
					style="font-weight:bold; font-size:1.2em;" />

				<h:panelGroup />
				
				<h:panelGroup rendered="#{resourceBean.allowedRequestsUsed}">
				<h:outputLabel 
					id="allowedRequestsLabel"
					value="#{web.text.ALLOWEDREQUESTS}" style="font-size:1.2em;" />
				</h:panelGroup>
				<h:panelGroup  
					rendered="#{resourceBean.allowedRequestsUsed}">
					<h:selectOneMenu 
						id="allowedRequests"
						value="#{resourceBean.numberOfRequests}" 
						disabled="#{!resourceBean.allowedToAddEndEntity}">
						<f:selectItems value="#{resourceBean.allowedRequests}" />
					</h:selectOneMenu>
				</h:panelGroup>
				
				<h:panelGroup rendered="#{resourceBean.useKeyRecovery}">
					<h:outputLabel
						id="useKeyRecoveryLabel" 
						value="#{web.text.KEYRECOVERABLE}"
						style="font-size:1.2em;" />
					<h:outputText
						value="#{web.ejbcaWebBean.getHelpReference('/Key_Recovery.html')}"
						escape="false" styleClass="helpReference" />
				</h:panelGroup>
				<h:panelGroup rendered="#{resourceBean.useKeyRecovery}">
					<h:selectBooleanCheckbox id="useKeyRecovery"
						value="#{resourceBean.keyRecoveryCheckboxStatus.left}"
						disabled="#{resourceBean.keyRecoveryCheckboxStatus.right}" />
					<h:outputLabel value="#{web.text.ACTIVATE}" for="useKeyRecovery" />
				</h:panelGroup>
				
				<h:panelGroup rendered="#{resourceBean.useIssuanceRevocationReason}">
				<h:outputLabel id="useIssuanceRevocationReasonLabel"
					value="#{web.text.ISSUANCEREVOCATIONREASON}" style="font-size:1.2em;" />
				</h:panelGroup>
				<h:panelGroup id="useIssuanceRevocationReason" rendered="#{resourceBean.useIssuanceRevocationReason}">
					<h:selectOneMenu value="#{resourceBean.revocationStatus}" 
						disabled="#{!resourceBean.allowedToAddEndEntity || resourceBean.issuanceRevocationReasonDisabled}">
						<f:selectItems value="#{resourceBean.issuanceRevocationReasons}" />
					</h:selectOneMenu>
				</h:panelGroup>

				<h:panelGroup rendered="#{resourceBean.useSendNotification}">
					<h:outputLabel id="useSendNotificationLabel"
						value="#{web.text.SENDNOTIFICATION}"
						style="font-size:1.2em;" />
				</h:panelGroup>
				<h:panelGroup rendered="#{resourceBean.useSendNotification}">
					<h:selectBooleanCheckbox id="useSendNotification"
						value="#{resourceBean.sendNotification}"
						disabled="#{resourceBean.sendNotificationRequired}" />
					<h:outputLabel value="#{web.text.ACTIVATE}" for="useSendNotification" />
				</h:panelGroup>

				<h:panelGroup rendered="#{resourceBean.usePrintingEnabled}">
					<h:outputLabel id="usePrintingLabel" value="#{web.text.PRINTUSERDATA}"
						style="font-size:1.2em;" />
				</h:panelGroup>
				<h:panelGroup rendered="#{resourceBean.usePrintingEnabled}">
					<h:selectBooleanCheckbox id="usePrinting"
						value="#{resourceBean.usePrinting}"
						disabled="#{resourceBean.printingRequired}" />
					<h:outputLabel value="#{web.text.PRINT}" for="usePrinting" />
				</h:panelGroup>				
			</h:panelGrid>

    		<!-- Form buttons  -->

			<h:panelGrid columns="2" styleClass="edit-top" cellspacing="3"
				cellpadding="3" border="0" width="100%" rowClasses="Row1"
				columnClasses="editColumnSystem1,editColumn2">
				<h:panelGroup />

				<h:panelGroup>

				<h:commandButton id="buttonAdd" value="#{web.text.ADD}"
						action="#{resourceBean.addUser}" />
                    &nbsp;&nbsp;&nbsp;
            	<h:commandButton id="buttonCancel" value="#{web.text.CANCEL}" 
            			  action="#{resourceBean.redirectToAdminweb}" immediate="true"/>
            		&nbsp;&nbsp;&nbsp;
            	<h:commandButton id="buttonReload" value="#{web.text.RELOAD}" rendered="#{resourceBean.renderReloadButton}" 
            			  action="#{resourceBean.reloadAddEndEntityPage}"/>
				</h:panelGroup>

			</h:panelGrid>

			<!-- Show results section -->
			
			<p:dataTable id="resultsTable" paginator="true"
				value="#{resourceBean.addedUsers.left}" var="addedUser"
				paginatorPosition="both"
				paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
				currentPageReportTemplate="{startRecord}-{endRecord} of {totalRecords} records"
				rowsPerPageTemplate="5,10,{ShowAll|'All'}" 
				rows="10"
				rowKey="#{addedUser.username}"
				allowUnsorting="true" 
				sortMode="single"
				disabledTextSelection="false">

				<p:column headerText="#{web.text.USERNAME_ABBR}">
					<h:outputText
						value="#{resourceBean.encodeUserName(addedUser.username)}" />
				</p:column>
				<p:column headerText="#{web.text.DN_ABBR_COMMONNAME}">
					<h:outputText value="#{resourceBean.getAddedUserCN(addedUser)}" />
				</p:column>
				<p:column headerText="#{web.text.DN_ABBR_ORGANIZATIONALUNIT}">
					<h:outputText value="#{resourceBean.getAddedUserOU(addedUser)}" />
				</p:column>
				<p:column headerText="#{web.text.DN_ABBR_ORGANIZATION}">
					<h:outputText value="#{resourceBean.getAddedUserO(addedUser)}" />
				</p:column>
				<p:column headerText="#{web.text.ACTIONS}">
					<p:menuButton value="#{web.text.ENDENTITY}">
						<p:menuitem value="#{web.text.VIEW}"
							onclick="window.open('#{resourceBean.getViewEndEntityPopupLink(addedUser.username)}', 'view_user','height=750,width=750,scrollbars=yes,toolbar=no,resizable=1').focus();"
							icon="pi pi-external-link" />
						<p:menuitem value="#{web.text.EDIT}"
							onclick="window.open('#{resourceBean.getEditEndEntityPopupLink(addedUser.username)}', 'edit_user','height=750,width=750,scrollbars=yes,toolbar=no,resizable=1').focus();"
							icon="pi pi-external-link" />

					</p:menuButton>
				</p:column>
			</p:dataTable>

		</h:form>
	</ui:define>
</ui:composition>
</html>
