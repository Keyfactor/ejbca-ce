<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions">
<ui:remove>
	<!--
    /*************************************************************************
     *                                                                       *
     *  EJBCA: The OpenSource Certificate Authority                          *
     *                                                                       *
     *  This software is free software; you can redistribute it and/or       *
     *  modify it under the terms of the GNU Lesser General Public           *
     *  License as published by the Free Software Foundation; either         *
     *  version 2.1 of the License, or any later version.                    *
     *                                                                       *
     *  See terms of license at gnu.org.                                     *
     *                                                                       *
     *************************************************************************/

      -->
</ui:remove>


<ui:composition template="/WEB-INF/include/template.xhtml">

	<ui:param name="resourceBean" value="#{addEndEntityMBean}" />
	<ui:define name="content">
		<p:inputText rendered="false" />
		<h1>
			<h:outputText value="#{web.text.ADDENDENTITY}" />
		</h1>

		<h:form id="addendentity" enctype="multipart/form-data">

			<h:panelGrid columns="2" styleClass="edit-top" cellspacing="3"
				cellpadding="3" border="0" width="100%" rowClasses="Row1"
				columnClasses="editColumnSystem1,editColumn2">
				<h:outputLabel for="header_endentityprofile"
					value="#{web.text.ENDENTITYPROFILE}"
					style="font-weight:bold; font-size:1.2em;" />

				<h:panelGroup id="endEntityProfile">
					<h:selectOneMenu value="#{resourceBean.selectedEeProfileId}"
						disabled="#{!resourceBean.allowedToAddEndEntity}">
						<f:selectItems value="#{resourceBean.availableEndEntityProfiles}" />
						<f:ajax render="addendentity"
							listener="#{resourceBean.actionChangeEndEntityProfile}" />
					</h:selectOneMenu>
				</h:panelGroup>

				<h:panelGroup>
					<h:outputLabel for="username" value="#{web.text.USERNAME}"
						styleClass="titles" />
				</h:panelGroup>

				<h:inputText 
					id="username" value="#{resourceBean.userName}"
					required="true"
					styleClass="mandatory"
					size="45" title="#{resourceBean.usernameTitle}"
					label="Username"
					disabled="#{!resourceBean.allowedToAddEndEntity or resourceBean.usernameAutoGenerated}" />

				<h:panelGroup>
					<h:outputLabel for="userPassword"
						value="#{web.text.PASSWORDORENROLLMENTCODE}" />
				</h:panelGroup>

				<h:inputSecret id="userPassword" name="password" size="25"
					maxlength="225" redisplay="true" autocomplete="off"
					required="true"
					label="Password"
					styleClass="mandatory"
					rendered="#{!resourceBean.useAutoGeneratedPassword}"
					disabled="#{!resourceBean.allowedToAddEndEntity}"
					value="#{resourceBean.passwordFieldValue}">
				</h:inputSecret>

				<h:panelGroup>
					<h:outputLabel for="userConfirmPassword"
						value="#{web.text.CONFIRMPASSWORD}" />
				</h:panelGroup>

				<h:inputSecret id="userConfirmPassword" name="confirmpassword"
					size="25" maxlength="225" redisplay="true" autocomplete="off"
					rendered="#{!resourceBean.useAutoGeneratedPassword}"
					value="#{resourceBean.confirmPasswordFieldValue}"
					disabled="#{!resourceBean.allowedToAddEndEntity}">
				</h:inputSecret>
				
				
				<h:panelGroup rendered="#{resourceBean.useMaxFailedLoginAttempts}">
					<h:outputLabel for="maxFailedLoginAttempts"
						value="#{web.text.MAXFAILEDLOGINATTEMPTS}" />
				</h:panelGroup>
				<h:panelGroup rendered="#{resourceBean.useMaxFailedLoginAttempts}">
					<h:panelGrid columns="3">
						<h:selectOneRadio id="maxLoginAttemptsSpecifiedRadio"
							value="#{resourceBean.maxLoginAttemptsStatus}"
							readonly="#{!resourceBean.allowedToAddEndEntity or !resourceBean.maxFailedLoginAttemptsModifiable}">
							<f:selectItem itemLabel="#{web.text.UNLIMITED}"
								itemValue="unlimited" />
							<f:selectItem itemLabel="#{web.text.SPECIFIED}"
								itemValue="specified" />
							<f:ajax
								render=":addendentity:maxLoginAttemptsSpecifiedText maxLoginAttemptsUnlimitedRadio" />
						</h:selectOneRadio>
						<h:inputText id="maxLoginAttemptsSpecifiedText"
							value="#{resourceBean.maxLoginAttempts}" size="5"
							title="#{web.text.FORMAT_INTEGER}"
							disabled="#{resourceBean.maxLoginAttemptsStatus eq 'unlimited'}"
							readonly="#{!resourceBean.allowedToAddEndEntity or !resourceBean.maxFailedLoginAttemptsModifiable}" />
					</h:panelGrid>
				</h:panelGroup>
				<h:panelGroup rendered="#{resourceBean.useBatchGenerationPassword}">
					<h:outputLabel for="useClearTextPassword"
						value="#{web.text.USEINBATCH}" />
				</h:panelGroup>
				<h:panelGroup rendered="#{resourceBean.useBatchGenerationPassword}">
					<h:selectBooleanCheckbox id="useClearTextPassword"
						value="#{resourceBean.useClearTextPasswordStorage}"
						disabled="#{resourceBean.clearTextPasswordRequired}" />
					<h:outputLabel value="#{web.text.USE}" for="useClearTextPassword" />
				</h:panelGroup>
				<h:panelGroup rendered="#{resourceBean.useEmail}">
					<h:outputLabel for="useEmail" value="#{web.text.EMAIL}" />
				</h:panelGroup>
				<h:panelGroup rendered="#{resourceBean.useEmail}">
					<h:inputText id="emailNoModify"
						value="#{resourceBean.emailUserName}" size="20" maxlength="255"
						readonly="#{!resourceBean.allowedToAddEndEntity}" /> @
					<h:outputLabel value="#{resourceBean.emailDomain}"
						rendered="#{resourceBean.onlyOneEmailDomain and !resourceBean.emailModifiable}" />
					<h:selectOneMenu
						rendered="#{!resourceBean.onlyOneEmailDomain and !resourceBean.emailModifiable}"
						value="#{resourceBean.selectedEmailDomain}"
						disabled="#{!resourceBean.allowedToAddEndEntity}">
						<f:selectItems value="#{resourceBean.availableEmailDomains}" />
					</h:selectOneMenu>
					<h:inputText id="emailModify"
						rendered="#{resourceBean.emailModifiable}"
						value="#{resourceBean.selectedEmailDomain}" size="15" maxlength="255"
						title="#{web.text.FORMAT_DOMAINNAME}"
						readonly="#{!resourceBean.allowedToAddEndEntity}" />
				</h:panelGroup>
			</h:panelGrid>

			<!-- Subject DN Section -->

			<h:panelGrid columns="2" styleClass="edit-top" cellspacing="3"
				cellpadding="3" border="0" width="100%" rowClasses="Row1"
				columnClasses="editColumnSystem1,editColumn2">
				<h:outputLabel value="#{web.text.CERT_SUBJECTDN_ATTRIBUTES}"
					style="font-weight:bold; font-size:1.2em;" />

				<h:panelGroup />
				<c:forEach items="#{resourceBean.subjectDnFieldsAndDatas}"
					var="subjectDnFieldAndData">
					<h:panelGroup>
						<h:outputLabel value="#{subjectDnFieldAndData.label}" />
					</h:panelGroup>
					<h:panelGroup
						rendered="#{!subjectDnFieldAndData.email and !subjectDnFieldAndData.modifiable   
										      and fn:length(subjectDnFieldAndData.options) == 1}">
						<h:outputLabel
							value="#{subjectDnFieldAndData.options[0].trim()}"
							style="font-weight:bold" />
					</h:panelGroup>
					<h:panelGroup
						rendered="#{!subjectDnFieldAndData.email 
										      and !subjectDnFieldAndData.modifiable 
										      and fn:length(subjectDnFieldAndData.options) > 1 }">
						<h:selectOneMenu value="#{subjectDnFieldAndData.fieldValue}"
							disabled="#{!resourceBean.allowedToAddEndEntity}">
							<f:selectItems value="#{subjectDnFieldAndData.options}" />
						</h:selectOneMenu>
					</h:panelGroup>
					<h:panelGroup 
						rendered="#{!subjectDnFieldAndData.email and subjectDnFieldAndData.modifiable and subjectDnFieldAndData.regex ne null}">
						<h:inputText value="#{subjectDnFieldAndData.fieldValue}" 
							size="40" maxlength="255"
							title="Must match format specified in profile. / Technical detail - the regex is #{subjectDnFieldAndData.regex}"
							readonly="#{!resourceBean.allowedToAddEndEntity}"
							required="#{subjectDnFieldAndData.required}"
							styleClass="#{subjectDnFieldAndData.required ? 'mandatory' : ''}"
							label="#{subjectDnFieldAndData.label}">
							<f:validateRegex pattern="#{subjectDnFieldAndData.regex}" /> 
						</h:inputText>
					</h:panelGroup>
					<h:panelGroup 
						rendered="#{!subjectDnFieldAndData.email and subjectDnFieldAndData.modifiable and subjectDnFieldAndData.regex eq null}">
						<h:inputText value="#{subjectDnFieldAndData.fieldValue}" 
							size="40" maxlength="255"
							readonly="#{!resourceBean.allowedToAddEndEntity}"
							required="#{subjectDnFieldAndData.required}"
							label="#{subjectDnFieldAndData.label}"
							styleClass="#{subjectDnFieldAndData.required ? 'mandatory' : ''}">
						</h:inputText>
					</h:panelGroup>
					
					<h:panelGroup
						rendered="#{subjectDnFieldAndData.email}">
						<h:selectBooleanCheckbox id="sdnEmail"
							value="#{subjectDnFieldAndData.required}"
							disabled="#{subjectDnFieldAndData.required}" />
						<h:outputLabel value="#{web.text.USESEMAILFIELDDATA}" />
					</h:panelGroup>
				</c:forEach>
			</h:panelGrid>


			<!-- Subject Alternative Names Section -->

 			<h:panelGrid columns="2" styleClass="edit-top" cellspacing="3"
				cellpadding="3" border="0" width="100%" rowClasses="Row1"
				columnClasses="editColumnSystem1,editColumn2"
				rendered="#{resourceBean.profileHasSubjectAltNameFields}">
				<h:outputLabel value="#{web.text.SUBJECTALTNAMES}"
					style="font-weight:bold; font-size:1.2em;" />

				<h:panelGroup />

				<c:forEach items="#{resourceBean.subjectAltNameFieldDatas}"
					var="subjectAltNameFieldAndData">


					<h:panelGroup>
						<h:outputLabel value="#{subjectAltNameFieldAndData.label}" />
					</h:panelGroup>

					<h:panelGroup
						rendered="#{subjectAltNameFieldAndData.rfc822Name and subjectAltNameFieldAndData.renderUseDataFromRFC822NameField}">
						<h:selectBooleanCheckbox id="altNameEmail" value="#{subjectAltNameFieldAndData.useDataFromRFC822NameField}"
							disabled="#{subjectAltNameFieldAndData.required}" />
						<h:outputLabel value="#{web.text.USESEMAILFIELDDATA}" />
					</h:panelGroup>

					<h:panelGroup
						rendered="#{subjectAltNameFieldAndData.rfc822Name and !subjectAltNameFieldAndData.renderUseDataFromRFC822NameField
									and (subjectAltNameFieldAndData.modifiable or subjectAltNameFieldAndData.rfc822NameStringHaveAtSign)}">
						<h:inputText
							value="#{subjectAltNameFieldAndData.rfcName}"
							size="20" maxlength="255"
							readonly="#{!resourceBean.allowedToAddEndEntity}"> 
						</h:inputText> @
						<h:inputText
							value="#{subjectAltNameFieldAndData.rfcDomain}"
							size="15" maxlength="255" 
							title="#{web.text.FORMAT_DOMAINNAME}"
							readonly="#{!resourceBean.allowedToAddEndEntity}">
						</h:inputText>
					</h:panelGroup>

					<h:panelGroup
						rendered="#{subjectAltNameFieldAndData.rfc822Name 
									and !subjectAltNameFieldAndData.modifiable and fn:length(subjectAltNameFieldAndData.options) == 1}">
						<h:outputLabel
							value="#{subjectAltNameFieldAndData.fieldValue}"
							style="font-weight:bold" />
					</h:panelGroup>

					<h:panelGroup
						rendered="#{subjectAltNameFieldAndData.rfc822Name  
									and !subjectAltNameFieldAndData.modifiable and fn:length(subjectAltNameFieldAndData.options) > 1}}">

						<h:selectOneMenu value="#{subjectAltNameFieldAndData.fieldValue}"
							disabled="#{!resourceBean.allowedToAddEndEntity}">
							<f:selectItems
								value="#{subjectAltNameFieldAndData.options}" />
						</h:selectOneMenu>
					</h:panelGroup>

					<h:panelGroup rendered="#{!subjectAltNameFieldAndData.rfc822Name and !subjectAltNameFieldAndData.modifiable}">
						<h:inputText
							rendered="#{!subjectAltNameFieldAndData.rfc822Name and !subjectAltNameFieldAndData.modifiable and subjectAltNameFieldAndData.upn}"
							value="#{subjectAltNameFieldAndData.upnName}"
							size="20" maxlength="255"
							readonly="#{!resourceBean.allowedToAddEndEntity}">
						</h:inputText> @

						<h:outputLabel
							rendered="#{(!subjectAltNameFieldAndData.rfc822Name and !subjectAltNameFieldAndData.modifiable and subjectAltNameFieldAndData.upn and fn:length(subjectAltNameFieldAndData.options) == 1)}"
							value="#{subjectAltNameFieldAndData.upnDomain}"
							style="font-weight:bold" />

						<h:selectOneMenu
							rendered="#{!subjectAltNameFieldAndData.rfc822Name and !subjectAltNameFieldAndData.modifiable and subjectAltNameFieldAndData.upn and fn:length(subjectAltNameFieldAndData.options) > 1}"
							value="#{subjectAltNameFieldAndData.upnDomain}"
							disabled="#{!resourceBean.allowedToAddEndEntity}">
							<f:selectItems value="#{subjectAltNameFieldAndData.options}" />
						</h:selectOneMenu>
					</h:panelGroup>

					<h:panelGroup
						rendered="#{!subjectAltNameFieldAndData.rfc822Name and subjectAltNameFieldAndData.modifiable and subjectAltNameFieldAndData.upn}">

						<h:inputText size="20" maxlength="255"
							value="#{subjectAltNameFieldAndData.upnName}"
							readonly="#{!resourceBean.allowedToAddEndEntity}">
						</h:inputText> @
						<h:inputText size="15" maxlength="255"
							value="#{subjectAltNameFieldAndData.upnDomain}"
							readonly="#{!resourceBean.allowedToAddEndEntity}">
						</h:inputText>
					</h:panelGroup>

					<h:panelGroup
						rendered="#{!subjectAltNameFieldAndData.rfc822Name and 
									 subjectAltNameFieldAndData.modifiable and 
									 !subjectAltNameFieldAndData.upn and 
									 (subjectAltNameFieldAndData.copyDataFromCN and subjectAltNameFieldAndData.dnsName)}">

						<h:selectBooleanCheckbox id="altNameDns"
							value="true" disabled="true"/>
						<h:outputLabel value="#{web.text.USESCNFIELDDATA}" />
					</h:panelGroup>

					<h:panelGroup
						rendered="#{!subjectAltNameFieldAndData.rfc822Name and subjectAltNameFieldAndData.modifiable and !subjectAltNameFieldAndData.upn
						  and !(subjectAltNameFieldAndData.copyDataFromCN and subjectAltNameFieldAndData.dnsName)}">
						<h:inputText size="40" maxlength="355" rendered="#{!subjectAltNameFieldAndData.renderRegex}"
							value="#{subjectAltNameFieldAndData.fieldValue}"
							label = "#{subjectAltNameFieldAndData.label}"
							required="#{subjectAltNameFieldAndData.required}"
							styleClass="#{subjectAltNameFieldAndData.required ? 'mandatory' : ''}"
							readonly="#{!resourceBean.allowedToAddEndEntity}">
						</h:inputText>
						<h:inputText size="40" maxlength="355" rendered="#{subjectAltNameFieldAndData.renderRegex}"
							value="#{subjectAltNameFieldAndData.fieldValue}"
							title="Must match format specified in profile. / Technical detail - the regex is #{subjectAltNameFieldAndData.regex}"
							label = "#{subjectAltNameFieldAndData.label}"
							required="#{subjectAltNameFieldAndData.required}"
							styleClass="#{subjectAltNameFieldAndData.required ? 'mandatory' : ''}"
							readonly="#{!resourceBean.allowedToAddEndEntity}">
						<f:validateRegex pattern="#{subjectAltNameFieldAndData.regex}"/>
						</h:inputText>
					</h:panelGroup>

				</c:forEach>

			</h:panelGrid>

			<!-- Subject Directory Attributes Section -->

			<h:panelGrid columns="2" styleClass="edit-top" cellspacing="3"
				cellpadding="3" border="0" width="100%" rowClasses="Row1"
				columnClasses="editColumnSystem1,editColumn2"
				rendered="#{resourceBean.profileHasSubjectDirAttrFields}">
				<h:outputLabel value="#{web.text.SUBJECTDIRATTRIBUTES}"
					style="font-weight:bold; font-size:1.2em;" />

				<h:panelGroup />

				<c:forEach items="#{resourceBean.subjectDirAttrFieldDatas}"
					var="subjectDirAttrFieldNameAndData">

					<h:panelGroup>
						<h:outputLabel value="#{subjectDirAttrFieldNameAndData.label}" />
					</h:panelGroup>

					<h:outputLabel
						rendered="#{!subjectDirAttrFieldNameAndData.modifiable and fn:length(subjectDirAttrFieldNameAndData.options) == 1}"
						value="#{subjectDirAttrFieldNameAndData.fieldValue}"
						style="font-weight:bold" />

					<h:selectOneMenu
						rendered="#{!subjectDirAttrFieldNameAndData.modifiable and fn:length(subjectDirAttrFieldNameAndData.options) > 1}"
						value="#{subjectDirAttrFieldNameAndData.fieldValue}"
						disabled="#{!resourceBean.allowedToAddEndEntity}">
						<f:selectItems value="#{subjectDirAttrFieldNameAndData.options}" />
					</h:selectOneMenu>

					<h:panelGroup
						rendered="#{subjectDirAttrFieldNameAndData.modifiable}">
						<h:inputText size="20" maxlength="255"
							value="#{subjectDirAttrFieldNameAndData.fieldValue}"
							readonly="#{!resourceBean.allowedToAddEndEntity}"
							required="#{subjectDirAttrFieldNameAndData.required}"
							label="#{subjectDirAttrFieldNameAndData.label}"
							styleClass="#{subjectDirAttrFieldNameAndData.required ? 'mandatory' : ''}">
						</h:inputText>
					</h:panelGroup>

				</c:forEach>

			</h:panelGrid>

			<!--  Main certificate data  -->

			<h:panelGrid columns="2" styleClass="edit-top" cellspacing="3"
				cellpadding="3" border="0" width="100%" rowClasses="Row1"
				columnClasses="editColumnSystem1,editColumn2">
				<h:outputLabel value="#{web.text.MAINCERTIFICATEDATA}"
					style="font-weight:bold; font-size:1.2em;" />
				<h:panelGroup />


				<h:outputLabel for="selectedCertProfile"
					value="#{web.text.CERTIFICATEPROFILE}" style="font-size:1.2em;" />

				<h:panelGroup id="selectedCertProfile">
					<h:selectOneMenu value="#{resourceBean.selectedCertProfileId}"
						disabled="#{!resourceBean.allowedToAddEndEntity}">
						<f:selectItems value="#{resourceBean.availableCertProfiles}" />
					<f:ajax event="change" render="selectedCa"/>
					</h:selectOneMenu>
				</h:panelGroup>
				
				<h:outputLabel for="selectedCa"
					value="#{web.text.CA}" style="font-size:1.2em;" />

				<h:panelGroup id="selectedCa">
					<h:selectOneMenu value="#{resourceBean.selectedCaId}"
						disabled="#{!resourceBean.allowedToAddEndEntity}">
						<f:selectItems value="#{resourceBean.availableCas}" />
					</h:selectOneMenu>
				</h:panelGroup>

				<h:outputLabel value="#{web.text.TOKEN}" style="font-size:1.2em;" />

				<h:panelGroup id="token">
					<h:selectOneMenu value="#{resourceBean.selectedTokenId}"
						disabled="#{!resourceBean.allowedToAddEndEntity}">
						<f:selectItems value="#{resourceBean.availableTokens}" />
						<f:ajax render="addendentity:useKeyRecovery" listener="#{resourceBean.keyRecoveryCheckboxStatusUpdate()}"/>
					</h:selectOneMenu>
				</h:panelGroup>
			</h:panelGrid>


			<!-- Other certificate data -->

			<h:panelGrid columns="2" styleClass="edit-top" cellspacing="3"
				cellpadding="3" border="0" width="100%" rowClasses="Row1"
				columnClasses="editColumnSystem1,editColumn2"
				rendered="#{resourceBean.renderOtherCertDataSection}">
				<h:outputLabel value="#{web.text.OTHERCERTIFICATEDATA}"
					style="font-weight:bold; font-size:1.2em;" />

				<h:panelGroup />

				<h:panelGroup rendered="#{resourceBean.customSerialNumberUsed}">

					<h:outputLabel value="#{web.text.CERT_SERIALNUMBER_HEXA}"
						style="font-size:1.2em;" />
					<br />
					<h:outputLabel styleClass="help"
						value="(#{web.text.EXAMPLE.toLowerCase()} : 1234567890ABCDEF)" />

				</h:panelGroup>

				<h:panelGroup rendered="#{resourceBean.customSerialNumberUsed}">
					<h:inputText size="20" maxlength="40"
						title="#{web.text.FORMAT_HEXA}" class="hexa" value="#{resourceBean.customSerialNumber}" />
				</h:panelGroup>


				<h:panelGroup rendered="#{resourceBean.validityStartTimeUsed}">
					<h:outputLabel value="#{web.text.TIMEOFSTART}"
						style="font-size:1.2em;" />
					<h:outputText
						value="#{web.ejbcaWebBean.getHelpReference('/End_Entity_Profiles.html#Certificate_Validity')}"
						escape="false" styleClass="helpReference" />
					<br />
					<h:outputLabel styleClass="help"
						value="#{resourceBean.validityTimeHelpText}" />
				</h:panelGroup>

				<h:panelGroup rendered="#{resourceBean.validityStartTimeUsed}">
					<h:inputText size="25" maxlength="40"
						title="#{resourceBean.validityTimeTitle}"
						value="#{resourceBean.validityStartTimeValue}"
						readonly="#{resourceBean.validityStartTimeReadOnly}"
						required="#{resourceBean.validityStartTimeRequired}"
						styleClass="#{resourceBean.validityStartTimeRequired ? 'mandatory' : ''}" />
				</h:panelGroup>

				<h:panelGroup rendered="#{resourceBean.validityEndTimeUsed}">
					<h:outputLabel value="#{web.text.TIMEOFEND}"
						style="font-size:1.2em;" />
					<h:outputText
						value="#{web.ejbcaWebBean.getHelpReference('/End_Entity_Profiles.html#Certificate_Validity')}"
						escape="false" styleClass="helpReference" />
					<br />
					<h:outputLabel styleClass="help"
						value="#{resourceBean.validityTimeHelpText}" />
				</h:panelGroup>

				<h:panelGroup rendered="#{resourceBean.validityEndTimeUsed}">
					<h:inputText size="25" maxlength="40"
						title="#{resourceBean.validityTimeTitle}"
						value="#{resourceBean.validityEndTimeValue}"
						readonly="#{resourceBean.validityEndTimeReadOnly}"
						required="#{resourceBean.validityEndTimeRequired}"
						styleClass="#{resourceBean.validityEndTimeRequired ? 'mandatory' : ''}" />
				</h:panelGroup>

				<h:panelGroup rendered="#{resourceBean.cardNumberUsed}">
					<h:outputLabel value="#{web.text.CARDNUMBER}"
						style="font-size:1.2em;" />
				</h:panelGroup>

				<h:panelGroup rendered="#{resourceBean.cardNumberUsed}">
					<h:inputText size="20" maxlength="40"
						title="#{web.text.FORMAT_STRING}"
						value="#{resourceBean.cardNumber}"
						styleClass="#{resourceBean.cardNumberRequired ? 'mandatory' : ''}" />
				</h:panelGroup>

				<h:panelGroup
					rendered="#{resourceBean.nameConstraintsPermittedUsed}">

					<h:outputLabel value="#{web.text.EXT_PKIX_NC_PERMITTED}"
						style="font-size:1.2em;" />
					<h:outputText
						value="#{web.ejbcaWebBean.getHelpReference('/CA_Fields.html#Name_Constraints')}"
						escape="false" styleClass="helpReference" />
					<br />
					<h:outputLabel styleClass="help"
						value="#{resourceBean.nameConstraintsPermittedHelpText}" />

				</h:panelGroup>

				<h:panelGroup
					rendered="#{resourceBean.nameConstraintsPermittedUsed}">

					<h:inputTextarea rows="4" cols="38"
						styleClass="#{resourceBean.nameConstraintsPermittedRequired ? 'mandatory' : ''}"
						value="#{resourceBean.nameConstraintsPermitted}" />

				</h:panelGroup>

				<h:panelGroup rendered="#{resourceBean.nameConstraintsExcludedUsed}">

					<h:outputLabel value="#{web.text.EXT_PKIX_NC_EXCLUDED}"
						style="font-size:1.2em;" />
					<h:outputText
						value="#{web.ejbcaWebBean.getHelpReference('/CA_Fields.html#Name_Constraints')}"
						escape="false" styleClass="helpReference" />
					<br />
					<h:outputLabel styleClass="help"
						value="#{resourceBean.nameConstraintsExcludedHelpText}" />

				</h:panelGroup>

				<h:panelGroup rendered="#{resourceBean.nameConstraintsExcludedUsed}">

					<h:inputTextarea rows="4" cols="38"
						styleClass="#{resourceBean.nameConstraintsExcludedRequired ? 'mandatory' : ''}"
						value="#{resourceBean.nameConstraintsExcluded}" />

				</h:panelGroup>


				<h:panelGroup rendered="#{resourceBean.useExtensionData}">
					<h:outputLabel value="#{web.text.CERT_EXTENSIONDATA}"
						style="font-size:1.2em;" />
				</h:panelGroup>

				<h:panelGroup rendered="#{resourceBean.useExtensionData}">

					<h:inputTextarea rows="4" cols="38"
						value="#{resourceBean.extensionData}" />
				</h:panelGroup>

				<h:panelGroup rendered="#{resourceBean.psd2QcStatementUsed}">

					<h:outputLabel value="#{web.text.PSD2_NCANAME}"
						style="font-size:1.2em;" />

				</h:panelGroup>

				<h:panelGroup rendered="#{resourceBean.psd2QcStatementUsed}">

					<h:inputText size="30" maxlength="256"
						value="#{resourceBean.psd2NcaName}" />
				</h:panelGroup>

				<h:panelGroup rendered="#{resourceBean.psd2QcStatementUsed}">

					<h:outputLabel value="#{web.text.PSD2_NCAID}"
						style="font-size:1.2em;" />

				</h:panelGroup>

				<h:panelGroup rendered="#{resourceBean.psd2QcStatementUsed}">

					<h:inputText size="30" maxlength="256"
						value="#{resourceBean.psd2NcaId}" />
				</h:panelGroup>

				<h:panelGroup rendered="#{resourceBean.psd2QcStatementUsed}">

					<h:outputLabel value="#{web.text.PSD2_PSP_ROLES}"
						style="font-size:1.2em;" />

				</h:panelGroup>

				<h:panelGroup rendered="#{resourceBean.psd2QcStatementUsed}">

					<h:selectManyListbox value="#{resourceBean.psd2PspRoles}" size="4"
						styleClass="select-list">
						<f:selectItems value="#{resourceBean.availablePsd2PspRoles}" />
					</h:selectManyListbox>

				</h:panelGroup>

				<h:panelGroup
					rendered="#{resourceBean.cabfOrganizationIdentifierUsed}">

					<h:outputLabel value="#{web.text.EXT_CABF_ORGANIZATION_IDENTIFIER}"
						style="font-size:1.2em;" />

				</h:panelGroup>

				<h:panelGroup
					rendered="#{resourceBean.cabfOrganizationIdentifierUsed}">

					<h:inputText size="30" maxlength="256"
						value="#{resourceBean.cabfOrganizationIdentifier}"
						readonly="#{resourceBean.cabfOrganizationIdentifierReadOnly}"
						title="#{web.text.EXT_CABF_ORGANIZATION_IDENTIFIER_FORMAT}"
						styleClass="#{resourceBean.cabfOrganizationIdentifierRequired ? 'mandatory' : ''}">
						<f:validateRegex pattern="[A-Z0-9]{5,5}(\+[A-Z0-9]+)?-.+" />
					</h:inputText>

				</h:panelGroup>
			</h:panelGrid>


			<!--  Other data  -->

			<h:panelGrid columns="2" styleClass="edit-top" cellspacing="3"
				cellpadding="3" border="0" width="100%" rowClasses="Row1"
				columnClasses="editColumnSystem1,editColumn2"
				rendered="#{resourceBean.renderOtherDataSection}">
				<h:outputLabel value="#{web.text.OTHERDATA}"
					style="font-weight:bold; font-size:1.2em;" />

				<h:panelGroup />
				
				<h:panelGroup rendered="#{resourceBean.allowedRequestsUsed}">
				<h:outputLabel 
					value="#{web.text.ALLOWEDREQUESTS}" style="font-size:1.2em;" />
				</h:panelGroup>
				<h:panelGroup id="allowedRequests" rendered="#{resourceBean.allowedRequestsUsed}">
					<h:selectOneMenu value="#{resourceBean.numberOfRequests}" 
						disabled="#{!resourceBean.allowedToAddEndEntity}">
						<f:selectItems value="#{resourceBean.allowedRequests}" />
					</h:selectOneMenu>
				</h:panelGroup>
				
				<h:panelGroup rendered="#{resourceBean.useKeyRecovery}">

					<h:outputLabel value="#{web.text.KEYRECOVERABLE}"
						style="font-size:1.2em;" />
					<h:outputText
						value="#{web.ejbcaWebBean.getHelpReference('/Key_Recovery.html')}"
						escape="false" styleClass="helpReference" />
				</h:panelGroup>
				<h:panelGroup rendered="#{resourceBean.useKeyRecovery}">
					<h:selectBooleanCheckbox id="useKeyRecovery"
						value="#{resourceBean.keyRecoveryCheckboxStatus.left}"
						disabled="#{resourceBean.keyRecoveryCheckboxStatus.right}" />
					<h:outputLabel value="#{web.text.ACTIVATE}" for="useKeyRecovery" />
				</h:panelGroup>
				
				<h:panelGroup rendered="#{resourceBean.useIssuanceRevocationReason}">
				<h:outputLabel 
					value="#{web.text.ISSUANCEREVOCATIONREASON}" style="font-size:1.2em;" />
				</h:panelGroup>
				<h:panelGroup id="useIssuanceRevocationReason" rendered="#{resourceBean.useIssuanceRevocationReason}">
					<h:selectOneMenu value="#{resourceBean.revocationStatus}" 
						disabled="#{!resourceBean.allowedToAddEndEntity || resourceBean.issuanceRevocationReasonDisabled}">
						<f:selectItems value="#{resourceBean.issuanceRevocationReasons}" />
					</h:selectOneMenu>
				</h:panelGroup>


				<h:panelGroup rendered="#{resourceBean.useSendNotification}">

					<h:outputLabel value="#{web.text.SENDNOTIFICATION}"
						style="font-size:1.2em;" />
				</h:panelGroup>
				<h:panelGroup rendered="#{resourceBean.useSendNotification}">
					<h:selectBooleanCheckbox id="useSendNotification"
						value="#{resourceBean.sendNotification}"
						disabled="#{resourceBean.sendNotificationRequired}" />
					<h:outputLabel value="#{web.text.ACTIVATE}" for="useSendNotification" />
				</h:panelGroup>


				<h:panelGroup rendered="#{resourceBean.usePrintingEnabled}">

					<h:outputLabel value="#{web.text.PRINTUSERDATA}"
						style="font-size:1.2em;" />
				</h:panelGroup>
				<h:panelGroup rendered="#{resourceBean.usePrintingEnabled}">
					<h:selectBooleanCheckbox id="usePrinting"
						value="#{resourceBean.usePrinting}"
						disabled="#{resourceBean.printingRequired}" />
					<h:outputLabel value="#{web.text.PRINT}" for="usePrinting" />
				</h:panelGroup>				
			</h:panelGrid>

    		<!-- Form buttons  -->

			<h:panelGrid columns="2" styleClass="edit-top" cellspacing="3"
				cellpadding="3" border="0" width="100%" rowClasses="Row1"
				columnClasses="editColumnSystem1,editColumn2">
				<h:panelGroup />

				<h:panelGroup>

				<h:commandButton id="buttonAdd" value="#{web.text.ADD}"
						action="#{resourceBean.addUser}" />
                    &nbsp;&nbsp;&nbsp;
            	<h:commandButton id="buttonCancel" value="#{web.text.CANCEL}" 
            			  action="#{resourceBean.redirectToAdminweb}" immediate="true"/>
            		&nbsp;&nbsp;&nbsp;
            	<h:commandButton id="buttonReload" value="#{web.text.RELOAD}" rendered="#{resourceBean.renderReloadButton}" 
            			  action="#{resourceBean.reloadAddEndEntityPage}"/>
				</h:panelGroup>

			</h:panelGrid>

			<!-- Show results section -->
			
			<p:dataTable id="resultsTable" paginator="true"
				value="#{resourceBean.addedUsers.left}" var="addedUser"
				paginatorPosition="both"
				paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
				currentPageReportTemplate="{startRecord}-{endRecord} of {totalRecords} records"
				rowsPerPageTemplate="5,10,{ShowAll|'All'}" 
				rows="10"
				rowKey="#{addedUser.username}"
				allowUnsorting="true" 
				sortMode="single"
				disabledTextSelection="false">

				<p:column headerText="#{web.text.USERNAME_ABBR}">
					<h:outputText
						value="#{resourceBean.encodeUserName(addedUser.username)}" />
				</p:column>
				<p:column headerText="#{web.text.DN_ABBR_COMMONNAME}">
					<h:outputText value="#{resourceBean.getAddedUserCN(addedUser)}" />
				</p:column>
				<p:column headerText="#{web.text.DN_ABBR_ORGANIZATIONALUNIT}">
					<h:outputText value="#{resourceBean.getAddedUserOU(addedUser)}" />
				</p:column>
				<p:column headerText="#{web.text.DN_ABBR_ORGANIZATION}">
					<h:outputText value="#{resourceBean.getAddedUserO(addedUser)}" />
				</p:column>
				<p:column headerText="#{web.text.ACTIONS}">
					<p:menuButton value="#{web.text.ENDENTITY}">
						<p:menuitem value="#{web.text.VIEW}"
							onclick="window.open('#{resourceBean.getViewEndEntityPopupLink(addedUser.username)}', 'view_user','height=750,width=750,scrollbars=yes,toolbar=no,resizable=1').focus();"
							icon="pi pi-external-link" />
						<p:menuitem value="#{web.text.EDIT}"
							onclick="window.open('#{resourceBean.getEditEndEntityPopupLink(addedUser.username)}', 'edit_user','height=750,width=750,scrollbars=yes,toolbar=no,resizable=1').focus();"
							icon="pi pi-external-link" />

					</p:menuButton>
				</p:column>
			</p:dataTable>

		</h:form>
	</ui:define>
</ui:composition>
</html>
